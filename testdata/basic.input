package test

import "github.com/goki/mat32"

//gosl: start basic

// DataStruct has the test data
type DataStruct struct {
	Raw   float32 `desc:"raw value"`
	Integ float32 `desc:"integrated value"`
	Exp   float32 `desc:"exp of integ"`
	Pad2  float32 `desc:"must pad to multiple of 4 floats for arrays"`
}

// ParamStruct has the test params
type ParamStruct struct {
	Tau float32 `desc:"rate constant in msec"`
	Dt  float32 `desc:"1/Tau"`
}

// IntegFmRaw computes integrated value from current raw value
func (ps *ParamStruct) IntegFmRaw(ds *DataStruct) {
	ds.Integ += ps.Dt * (ds.Raw - ds.Integ)
	ds.Exp = mat32.Exp(-ds.Integ)
}

//gosl: end basic

// note: only core compute code needs to be in shader -- all init is done CPU-side

func (ps *ParamStruct) Defaults() {
	ps.Tau = 5
	ps.Update()
}

func (ps *ParamStruct) Update() {
	ps.Dt = 1.0 / ps.Tau
}

//gosl: hlsl basic
/*
[[vk::binding(0, 0)]] uniform ParamStruct Params;
[[vk::binding(0, 1)]] RWStructuredBuffer<DataStruct> Data;
[numthreads(1, 1, 1)]
void main(uint3 idx : SV_DispatchThreadID) {
    Params.IntegFmRaw(Data[idx.x]);
}
*/
//gosl: end basic
